{"ast":null,"code":"import { computed, flow, makeObservable, observable } from \"mobx\";\nimport Api from '../utils/Api'; //import serv from '../../config';\n\nclass AuthStore {\n  constructor() {\n    this.token = null;\n    makeObservable(this, {\n      token: observable,\n      register: flow,\n      user: computed,\n      isLoggedIn: computed\n    });\n  }\n\n  async register(nickname, password, phone, role, name, surname, address, darktheme) {\n    const user = {\n      nickname: nickname,\n      password: password,\n      phone: phone,\n      role: role,\n      name: name,\n      surname: surname,\n      address: address,\n      darktheme: darktheme\n    };\n    const response = await fetch('http://localhost:8080/api/auth/register', {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json;charset=utf-8'\n      },\n      body: JSON.stringify(user)\n    });\n    const result = await response.json();\n    console.log(response.status);\n    /*const  = new Api().post(\n        'http://localhost:8080/api/auth/register',\n        {nickname, password, phone, role, name, surname, address, darktheme}\n    );\n    console.log(token);*/\n\n    if (token) {\n      this.token = token;\n    }\n  }\n\n  login(nickname, password, phone, role, name, surname, address, darktheme) {\n    const {\n      token\n    } = new Api().post('http://localhost:8080/api/auth/register', {\n      nickname,\n      password,\n      phone,\n      role,\n      name,\n      surname,\n      address,\n      darktheme\n    });\n    console.log(token);\n\n    if (token) {\n      this.token = token;\n    }\n  }\n\n  get user() {\n    if (!this.token) {\n      return null;\n    }\n\n    const [, encodedPayload] = this.token.split('.');\n\n    if (!encodedPayload) {\n      return null;\n    }\n\n    try {\n      return JSON.parse(window.atob(encodedPayload)).sub;\n    } catch (e) {\n      return null;\n    }\n  }\n\n  get isLoggedIn() {\n    return Boolean(this.user);\n  }\n\n}\n\nexport default new AuthStore();","map":{"version":3,"names":["computed","flow","makeObservable","observable","Api","AuthStore","constructor","token","register","user","isLoggedIn","nickname","password","phone","role","name","surname","address","darktheme","response","fetch","method","headers","body","JSON","stringify","result","json","console","log","status","login","post","encodedPayload","split","parse","window","atob","sub","e","Boolean"],"sources":["/media/vasya/Trash/files/Учеба/ШП/Выпускной проект/project/client/src/stores/AuthStore.js"],"sourcesContent":["import { computed, flow, makeObservable, observable } from \"mobx\";\nimport Api from '../utils/Api';\n//import serv from '../../config';\n\nclass AuthStore {\n    token = null;\n\n    constructor() {\n        makeObservable(this, {\n            token: observable,\n            register: flow,\n            user: computed,\n            isLoggedIn: computed\n        });\n    }\n\n    async register(nickname, password, phone, role, name, surname, address, darktheme) {\n        const user = {\n            nickname: nickname, password: password, phone: phone,role:role,name:name,surname:surname,address:address,darktheme:darktheme\n          };\n        const response = await fetch('http://localhost:8080/api/auth/register', {\n            method: 'POST',\n            headers: {\n              'Content-Type': 'application/json;charset=utf-8'\n            },\n            body: JSON.stringify(user)\n        });\n        const result = await response.json();\n        console.log(response.status);\n        /*const  = new Api().post(\n            'http://localhost:8080/api/auth/register',\n            {nickname, password, phone, role, name, surname, address, darktheme}\n        );\n        console.log(token);*/\n        if(token) {\n            this.token = token;\n        }\n    }\n\n    login(nickname, password, phone, role, name, surname, address, darktheme) {\n        const {token} = new Api().post(\n            'http://localhost:8080/api/auth/register',\n            {nickname, password, phone, role, name, surname, address, darktheme}\n        );\n        console.log(token);\n        if(token) {\n            this.token = token;\n        }\n    }\n\n    get user() {\n        if (!this.token) {\n          return null;\n        }\n    \n        const [, encodedPayload,] = this.token.split('.');\n    \n        if (!encodedPayload) {\n          return null;\n        }\n    \n        try {\n          return JSON.parse(window.atob(encodedPayload)).sub;\n        } catch(e) {\n          return null\n        }\n      }\n\n    get isLoggedIn() {\n        return Boolean(this.user);\n      }\n}\n\nexport default new AuthStore();\n"],"mappings":"AAAA,SAASA,QAAT,EAAmBC,IAAnB,EAAyBC,cAAzB,EAAyCC,UAAzC,QAA2D,MAA3D;AACA,OAAOC,GAAP,MAAgB,cAAhB,C,CACA;;AAEA,MAAMC,SAAN,CAAgB;EAGZC,WAAW,GAAG;IAAA,KAFdC,KAEc,GAFN,IAEM;IACVL,cAAc,CAAC,IAAD,EAAO;MACjBK,KAAK,EAAEJ,UADU;MAEjBK,QAAQ,EAAEP,IAFO;MAGjBQ,IAAI,EAAET,QAHW;MAIjBU,UAAU,EAAEV;IAJK,CAAP,CAAd;EAMH;;EAEa,MAARQ,QAAQ,CAACG,QAAD,EAAWC,QAAX,EAAqBC,KAArB,EAA4BC,IAA5B,EAAkCC,IAAlC,EAAwCC,OAAxC,EAAiDC,OAAjD,EAA0DC,SAA1D,EAAqE;IAC/E,MAAMT,IAAI,GAAG;MACTE,QAAQ,EAAEA,QADD;MACWC,QAAQ,EAAEA,QADrB;MAC+BC,KAAK,EAAEA,KADtC;MAC4CC,IAAI,EAACA,IADjD;MACsDC,IAAI,EAACA,IAD3D;MACgEC,OAAO,EAACA,OADxE;MACgFC,OAAO,EAACA,OADxF;MACgGC,SAAS,EAACA;IAD1G,CAAb;IAGA,MAAMC,QAAQ,GAAG,MAAMC,KAAK,CAAC,yCAAD,EAA4C;MACpEC,MAAM,EAAE,MAD4D;MAEpEC,OAAO,EAAE;QACP,gBAAgB;MADT,CAF2D;MAKpEC,IAAI,EAAEC,IAAI,CAACC,SAAL,CAAehB,IAAf;IAL8D,CAA5C,CAA5B;IAOA,MAAMiB,MAAM,GAAG,MAAMP,QAAQ,CAACQ,IAAT,EAArB;IACAC,OAAO,CAACC,GAAR,CAAYV,QAAQ,CAACW,MAArB;IACA;AACR;AACA;AACA;AACA;;IACQ,IAAGvB,KAAH,EAAU;MACN,KAAKA,KAAL,GAAaA,KAAb;IACH;EACJ;;EAEDwB,KAAK,CAACpB,QAAD,EAAWC,QAAX,EAAqBC,KAArB,EAA4BC,IAA5B,EAAkCC,IAAlC,EAAwCC,OAAxC,EAAiDC,OAAjD,EAA0DC,SAA1D,EAAqE;IACtE,MAAM;MAACX;IAAD,IAAU,IAAIH,GAAJ,GAAU4B,IAAV,CACZ,yCADY,EAEZ;MAACrB,QAAD;MAAWC,QAAX;MAAqBC,KAArB;MAA4BC,IAA5B;MAAkCC,IAAlC;MAAwCC,OAAxC;MAAiDC,OAAjD;MAA0DC;IAA1D,CAFY,CAAhB;IAIAU,OAAO,CAACC,GAAR,CAAYtB,KAAZ;;IACA,IAAGA,KAAH,EAAU;MACN,KAAKA,KAAL,GAAaA,KAAb;IACH;EACJ;;EAEO,IAAJE,IAAI,GAAG;IACP,IAAI,CAAC,KAAKF,KAAV,EAAiB;MACf,OAAO,IAAP;IACD;;IAED,MAAM,GAAG0B,cAAH,IAAsB,KAAK1B,KAAL,CAAW2B,KAAX,CAAiB,GAAjB,CAA5B;;IAEA,IAAI,CAACD,cAAL,EAAqB;MACnB,OAAO,IAAP;IACD;;IAED,IAAI;MACF,OAAOT,IAAI,CAACW,KAAL,CAAWC,MAAM,CAACC,IAAP,CAAYJ,cAAZ,CAAX,EAAwCK,GAA/C;IACD,CAFD,CAEE,OAAMC,CAAN,EAAS;MACT,OAAO,IAAP;IACD;EACF;;EAEW,IAAV7B,UAAU,GAAG;IACb,OAAO8B,OAAO,CAAC,KAAK/B,IAAN,CAAd;EACD;;AAlES;;AAqEhB,eAAe,IAAIJ,SAAJ,EAAf"},"metadata":{},"sourceType":"module"}